var plsQuery=false;var fmtLink=function(F,E,H,D){var C=H;var G;if(D.key=="orderid"){C="<a href=\"javascript:openDtl('"+contextRootPath+"/delivery/detail.do?recid="+E.recid+"');\" >"+H+"</a>"}else{if(D.key=="recid"){C="<a href=\"javascript:openDtl('"+contextRootPath+"/delivery/detail.do?recid="+E.recid+"');\" >"+H+"</a>"}else{if(D.key=="sel"){var B=isInArray(E.disstate,nonShow);if(B){G=' disabled="true"'}else{G=""}C='<input type="checkbox" name="recids" id="recids_'+E.recid+'" value="'+E.recid+'"'+G+' state="'+E.disstate+'">'}else{if(D.key=="oper"){var B=isInArray(E.disstate,nonShow);var A;if(B){G=' disabled="true"';A="_none"}else{G="";A=""}C='<input type="button" name="btnModify" id="btnModify'+A+'" value="修改状态"'+G+' class="btn_blue" onclick="DisstateMdfone(\''+E.recid+'\',this)" style="width:80px;">'}else{if(D.key=="createtime"){C=handlerdate(H,2)}else{if(D.key=="arrivetime"){C=handlerdate(H,2)}}}}}}return C};var successFncn=function(A){if(A.datas.length>0){setMdfBtn(false)}changeStyle()};var openDtl=function(A){openDlg(A,"订单明细",800,600,true)};var doQuery=function(){setMdfBtn(true);$("#showTbl").queryTable(optin)};function f_exportExcel(){if($("#recid").val()!=""){if(isNaN($("#recid").val())){f_showEMsg("配送单号必须为数字");$("#recid").val("");return}if($("#recid").val().indexOf(".")>-1){f_showEMsg("配送单号号必须为整数");$("#recid").val("");return}}sumbitExportExcel("exportExcel.do","content")}var dlgThis,setIds;var DisstateMdfone=function(B,A){$("input[name='recids']").each(function(){this.checked=false});$("#recids_"+B).attr("checked",true);showDisstateMdf();A.className="btn_blue"};var showDisstateMdf=function(){setMdfBtn(true);var D="",B=false;var C=0;$("input[name='recids']").each(function(){var E=$(this);if(E.attr("checked")){C++;D+=(B?",":"")+E.val();B=true}E=null});if(C<=0){alert("请选择需要修改状态的配送单!");setMdfBtn(false);return}setIds=D;var A={showButton:false,showClose:true,title:"修改状态",width:300,height:150,onopen:function(E){dlgThis=E},onclose:function(E){setMdfBtn(false)},contentType:"selector"};$.weeboxs.open("#selDisstate",A)};var closeDisstateMdf=function(){dlgThis.close();setMdfBtn(false)};var doDisstateMdf=function(){var B=$("input[name=parameter.disstate]:checked").val();if(!B||B==""){alert("请选择需要修改状态!");setMdfBtn(false);return}setMdfForm(setIds,B);dlgThis.close();setMdfBtn(true);var A=f_showPlan("处理中，请稍候。");var D=function(E){if(E.isSuccess){alert("修改成功");doQuery();setMdfForm("","")}else{alert(E.message)}A.close();setMdfBtn(false)};var C={dataType:"json",success:D};$("#frmModify").ajaxSubmit(C)};var setMdfBtn=function(A){$("#btnDisstate").attr("disabled",A);$("#btnOpenDis").attr("disabled",A);$("#btnFinishDis").attr("disabled",A);$("#btnModify").attr("disabled",A)};var setMdfForm=function(B,A){$("#frmModify > input").each(function(){var C=$(this);if(C.attr("name")=="parameter.recids"){C.val(B)}else{if(C.attr("name")=="parameter.disstate"){C.val(A)}}})};var doOpenDis=function(){var A=chkDisState(WAITDIS);if(A==0){alert("请选择配送单!");return false}else{if(A==-1){alert("启动配送的配送单必须都是“待配送”状态!");return false}}setMdfForm(setIds,DISING);doAJAXMdf("启动配送处理成功!")};var doAJAXMdf=function(D){setMdfBtn(true);var A=f_showPlan("处理中，请稍候。");var C=function(E){A.close();if(E.isSuccess){alert(D);doQuery();setMdfForm("","")}else{alert(E.message);setMdfBtn(false)}};var B={dataType:"json",success:C};$("#frmModify").ajaxSubmit(B)};var doFinishDis=function(){var A=chkDisState(DISING);if(A==0){alert("请选择配送单!");return false}else{if(A==-1){alert("完成配送的配送单必须都是“配送中”状态!");return false}}setMdfForm(setIds,DISOVER);doAJAXMdf("完成配送处理成功!")};var chkDisState=function(E){var D="",B=false;setIds="";var A=true,C=0;$("input[name='recids']").each(function(){var F=$(this);if(F.attr("checked")){C++;if(F.attr("state")!=E){A=false;return false}else{D+=(B?",":"")+F.val();B=true}}});if(C<1){return 0}if(A){setIds=D;return 1}else{return -1}};$(document).ready(function(){dTable=getTable($("#showTbl"),optin);var E=dTable.find("#jqTblBodyMark tr td");E.hide();var C=$("#btnQuery");C.click(doQuery);$("#btnExport").click(f_exportExcel);var B=$("#btnDisstate");var D=$("#btnOpenDis");var A=$("#btnFinishDis");B.click(showDisstateMdf);D.click(doOpenDis);A.click(doFinishDis);getMouthSelect($("#selMonth"),3,true);C.attr("disabled",false);B.attr("disabled",false);B;doQuery()});var changeStyle=function(){$("#showTbl .btn_blue").hover(function(){this.className="btn_blue_02"},function(){this.className="btn_blue"})};function closePage(){submitDlg.close();if(plsQuery){doQuery()}};