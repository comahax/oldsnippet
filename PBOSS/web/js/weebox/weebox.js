(function(C){var A={};var E=new Array();var B=function(H,G){var F=this;this.dh=null;this.mh=null;this.dc=null;this.dt=null;this.db=null;this.selector=null;this.ajaxurl=null;this.options=null;this._dragging=false;this._content=H||"";this._options=G||{};this._defaults={boxid:null,boxclass:null,cache:false,type:"dialog",title:"",width:0,height:0,timeout:0,draggable:true,modal:true,focus:null,blur:null,position:"center",overlay:30,showTitle:true,showButton:true,showCancel:true,showClose:true,showOk:true,okBtnName:"确定",cancelBtnName:"取消",contentType:"text",contentChange:false,clickClose:false,zIndex:999,animate:"",showAnimate:"",hideAnimate:"",onclose:null,onopen:null,oncancel:null,onok:null,suggest:{url:"",tele:"",vele:"",fn:null},select:{url:"",type:"radio",tele:"",vele:"",width:120,search:false,fn:null}};this.initOptions=function(){F._options=F._options||{};F._options.animate=F._options.animate||"";F._options.showAnimate=F._options.showAnimate||F._options.animate;F._options.hideAnimate=F._options.hideAnimate||F._options.animate;F._options.type=F._options.type||"dialog";F._options.title=F._options.title||"";F._options.boxclass=F._options.boxclass||F._options.type+"box";F._options.contentType=F._options.contentType||"";if(F._options.contentType==""){F._options.contentType=(F._content.substr(0,1)=="#")?"selector":"text"}F.options=C.extend({},F._defaults,F._options);F._options=null;F._defaults=null};this.initBox=function(){var I="";switch(F.options.type){case"alert":case"select":case"error":case"success":case"dialog":case"warning":I='<div class="dialog-box">	<div class="dialog-header">		<div class="dialog-tl"></div>		<div class="dialog-tc">			<div class="dialog-tc1"></div>			<div class="dialog-tc2"><a href="javascript:;" onclick="return false" title="关闭" class="dialog-close"></a><span class="dialog-title"></span></div>		</div>		<div class="dialog-tr"></div>	</div>	<table width="100%" border="0" cellspacing="0" cellpadding="0" >		<tr>			<td class="dialog-cl"></td>			<td>				<div class="dialog-content"></div>				<div class="dialog-button">					<input type="button" class="dialog-ok" value="确定">					<input type="button" class="dialog-cancel" value="取消">				</div>			</td>			<td class="dialog-cr"></td>		</tr>	</table>	<div class="dialog-bot">		<div class="dialog-bl"></div>		<div class="dialog-bc"></div>		<div class="dialog-br"></div>	</div></div>';break;case"custom":case"suggest":I='<div><div class="dialog-content"></div></div>';break}F.dh=C(I).appendTo("body").hide().css({position:"absolute",overflow:"hidden",zIndex:F.options.zIndex});F.dc=F.find(".dialog-content");F.dt=F.find(".dialog-title");F.db=F.find(".dialog-button");if(F.options.boxid){F.dh.attr("id",F.options.boxid)}if(F.options.boxclass){F.dh.addClass(F.options.boxclass)}if(F.options.height>0){F.dc.css("height",F.options.height)}if(F.options.width>0){F.dh.css("width",F.options.width)}F.dh.bgiframe()};this.initMask=function(){if(F.options.modal){F.mh=C("<div class='dialog-mask'></div>").appendTo("body").hide().css({width:F.bwidth(),height:F.bheight(),zIndex:F.options.zIndex-1}).bgiframe()}};this.initContent=function(M){F.dh.find(".dialog-ok").val(F.options.okBtnName);F.dh.find(".dialog-cancel").val(F.options.cancelBtnName);if(F.options.title==""){}else{F.dt.html(F.options.title)}if(!F.options.showClose){F.dh.find(".dialog-close").hide()}if(!F.options.showTitle){F.dh.find(".dialog-header").hide()}if(!F.options.showButton){F.dh.find(".dialog-button").hide()}if(!F.options.showCancel){F.dh.find(".dialog-cancel").hide()}if(!F.options.showOk){F.dh.find(".dialog-ok").hide()}if(F.options.type=="suggest"){F.hide();C(F.options.suggest.tele).unbind("keyup").keyup(function(){var P=C.trim(this.value);var O=null;for(key in A){if(key==P){O=A[key]}}if(O===null){C.ajax({type:"GET",data:{q:P},url:F.options.suggest.url||F._content,success:function(Q){O=Q},dataType:"json",async:false})}A[P]=O;var N="";for(key in O){N+="<li>"+O[key].name+"</li>"}F.setContent(N);F.show();F.find("li").click(function(){var Q=F.find("li").index(this);C(F.options.suggest.tele).val(O[Q].name);C(F.options.suggest.vele).val(O[Q].id);if(typeof F.options.suggest.fn=="function"){fn(O[Q])}F.hide()})})}else{if(F.options.type=="select"){var L=F.options.select.type||"radio";var I=F.options.select.url||F._content||"";var J=F.options.select.search||false;C.ajax({type:"GET",url:I,success:function(Q){var O="";if(Q===null){O="没有数据"}else{if(J){O+='<div class="wsearch"><input type="text"><input type="button" value="查询"></div>'}var N=C.trim(C(F.options.select.vele).val()).split(",");O+='<div class="wselect">';for(key in Q){var P=(C.inArray(Q[key].id,N)==-1)?"":'checked="checked"';O+='<li><label><input name="wchoose" '+P+' type="'+L+'" value="'+Q[key].id+'">'+Q[key].name+"</label></li>"}O+="</div>"}F.setContent(O);F.find("li").width(F.options.select.width);F.find(".wsearch input").keyup(function(){var R=C.trim(this.value);F.find("li").hide();for(i in Q){if(Q[i].id==R||Q[i].name.indexOf(R)!=-1){F.find("li:eq("+i+")").show()}}});F.setOnok(function(){if(L=="radio"){if(F.find(":checked").length==0){C(F.options.select.tele).val("");C(F.options.select.vele).val("")}else{var R=F.find(":radio[name=wchoose]").index(F.find(":checked")[0]);C(F.options.select.tele).val(Q[R].name);C(F.options.select.vele).val(Q[R].id);if(typeof F.options.select.fn=="function"){fn(Q[R])}}}else{if(F.find(":checked").length==0){C(F.options.select.tele).val("");C(F.options.select.vele).val("")}else{var U=[],S=[],T=[];F.find(":checked").each(function(){var V=F.find(":checkbox[name=wchoose]").index(this);U.push(Q[V]);S.push(Q[V].id);T.push(Q[V].name)});C(F.options.select.tele).val(T.join(","));C(F.options.select.vele).val(S.join(","));if(typeof F.options.select.fn=="function"){fn(U)}}}F.close()});F.show()},dataType:"json"})}else{if(F.options.contentType=="selector"){F.selector=F._content;F._content=C(F.selector).html();F.setContent(F._content);var K=C(F.selector).find(":checkbox");F.dc.find(":checkbox").each(function(N){this.checked=K[N].checked});C(F.selector).empty();F.show();F.focus();F.onopen()}else{if(F.options.contentType=="ajax"){F.ajaxurl=F._content;F.setLoading();F.show();F.dh.find(".dialog-button").hide();if(F.options.cache==false){if(F.ajaxurl.indexOf("?")==-1){F.ajaxurl+="?_t="+Math.random()}else{F.ajaxurl+="&_t="+Math.random()}}C.get(F.ajaxurl,function(N){F._content=N;F.setContent(F._content);F.show();F.focus();F.onopen()})}else{F.setContent(F._content);F.show();F.focus();F.onopen()}}}}};this.initEvent=function(){F.dh.find(".dialog-close, .dialog-cancel, .dialog-ok").unbind("click").click(function(){F.close()});if(typeof(F.options.onok)=="function"){F.dh.find(".dialog-ok").unbind("click").click(function(){F.options.onok(F)})}if(typeof(F.options.oncancel)=="function"){F.dh.find(".dialog-cancel").unbind("click").click(function(){F.options.oncancel(F)})}if(F.options.timeout>0){window.setTimeout(F.close,(F.options.timeout*1000))}this.drag()};this.setOnok=function(I){F.dh.find(".dialog-ok").unbind("click");if(typeof(I)=="function"){F.dh.find(".dialog-ok").click(function(){I(F)})}};this.setOncancel=function(I){F.dh.find(".dialog-cancel").unbind("click");if(typeof(I)=="function"){F.dh.find(".dialog-cancel").click(function(){I(F)})}};this.setOnclose=function(I){F.options.onclose=I};this.drag=function(){if(F.options.draggable&&F.options.showTitle){F.dh.find(".dialog-header").mousedown(function(I){var O=this;var L=document;var M=F.dh.position().left;var K=F.dh.position().top;var Q=I.clientX;var P=I.clientY;var J=F.dh.width();var R=F.dh.height();var N=F.bwidth();var S=F.bheight();if(O.setCapture){O.setCapture()}C(document).mousemove(function(T){if(window.getSelection){window.getSelection().removeAllRanges()}else{document.selection.empty()}var V=Math.max(M+T.clientX-Q,0);var U=Math.max(K+T.clientY-P,0);var V=Math.min(V,N-J);var U=Math.min(U,S-R);F.dh.css({left:V,top:U})}).mouseup(function(){if(O.releaseCapture){O.releaseCapture()}C(document).unbind("mousemove");C(document).unbind("mouseup")})})}};this.onopen=function(){if(typeof(F.options.onopen)=="function"){F.options.onopen(F)}};this.addButton=function(J){J=J||{};J.title=J.title||"OK";J.bclass=J.bclass||"dialog-btn1";J.fn=J.fn||null;J.index=J.index||0;var I=C('<input type="button" class="'+J.bclass+'" value="'+J.title+'">').click(function(){if(typeof J.fn=="function"){J.fn(F)}});if(J.index<F.db.find("input").length){F.db.find("input:eq("+J.index+")").before(I)}else{F.db.append(J)}};this.show=function(){if(F.options.showButton){F.dh.find(".dialog-button").show()}if(F.options.position=="center"){F.setCenterPosition()}else{F.setElementPosition()}if(typeof F.options.showAnimate=="string"){F.dh.show(F.options.animate)}else{F.dh.animate(F.options.showAnimate.animate,F.options.showAnimate.speed)}if(F.mh){F.mh.show()}};this.hide=function(I){if(typeof F.options.hideAnimate=="string"){F.dh.hide(F.options.animate,I)}else{F.dh.animate(F.options.hideAnimate.animate,F.options.hideAnimate.speed,"",I)}};this.focus=function(){C(window).focus();var I=F.dh.find(".dialog-ok");var J=F.dh.find(".dialog-cancel");if(F.options.focus){F.dh.find(F.options.focus).focus()}else{if(I.length>0){I.focus()}else{if(J.length>0){J.focus()}else{F.dh.find(".dialog-content").focus()}}}};this.find=function(I){return F.dh.find(I)};this.setLoading=function(){F.setContent('<div class="dialog-loading"></div>');F.dh.find(".dialog-button").hide();if(F.dc.height()<90){F.dc.height(Math.max(90,F.options.height))}if(F.dh.width()<200){F.dh.width(Math.max(200,F.options.width))}};this.setWidth=function(I){F.dh.width(I)};this.setTitle=function(I){F.dt.html(I)};this.getTitle=function(){return F.dt.html()};this.setContent=function(I){F.dc.html(I);if(F.options.height>0){F.dc.css("height",F.options.height)}else{F.dc.css("height","")}if(F.options.width>0){F.dh.css("width",F.options.width)}else{F.dh.css("width","")}if(F.options.showButton){F.dh.find(".dialog-button").show()}};this.getContent=function(){return F.dc.html()};this.disabledButton=function(J,I){F.dh.find(".dialog-"+J).attr("disabled",I)};this.hideButton=function(I){F.dh.find(".dialog-"+I).hide()};this.showButton=function(I){F.dh.find(".dialog-"+I).show()};this.setButtonTitle=function(J,I){F.dh.find(".dialog-"+J).val(I)};this.next=function(I){I=I||{};I.title=I.title||F.getTitle();I.content=I.content||"";I.okname=I.okname||"确定";I.width=I.width||260;I.onok=I.onok||F.close;I.onclose=I.onclose||null;I.oncancel=I.oncancel||null;I.hideCancel=I.hideCancel||true;F.setTitle(I.title);F.setButtonTitle("ok",okname);F.setWidth(width);F.setOnok(I.onok);if(I.content!=""){F.setContent(I.content)}if(I.hideCancel){F.hideButton("cancel")}if(typeof(I.onclose)=="function"){F.setOnclose(I.onclose)}if(typeof(I.oncancel)=="function"){F.setOncancel(I.oncancel)}F.show()};this.close=function(J){if(typeof(F.options.onclose)=="function"){F.options.onclose(F)}if(F.options.contentType=="selector"){if(F.options.contentChange){var I=F.find(":checkbox");C(F.selector).html(F.getContent());if(I.length>0){C(F.selector).find(":checkbox").each(function(K){this.checked=I[K].checked})}}else{C(F.selector).html(F._content)}}if(F.options.blur){C(F.options.blur).focus()}for(i=0;i<E.length;i++){if(E[i].dh.get(0)==F.dh.get(0)){E.splice(i,1);break}}F.hide();F.dh.remove();if(F.mh){F.mh.remove()}};this.bheight=function(){if(C.browser.msie&&C.browser.version<7){var J=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);var I=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);if(J<I){return C(window).height()}else{return J}}else{return C(document).height()}};this.bwidth=function(){if(C.browser.msie&&C.browser.version<7){var I=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);var J=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);if(I<J){return C(window).width()}else{return I}}else{return C(document).width()}};this.setCenterPosition=function(){var J=C(window),K=C(document),L=K.scrollTop(),I=K.scrollLeft();L+=(J.height()-F.dh.height())/2;I+=(J.width()-F.dh.width())/2;F.dh.css({top:L,left:I})};this.setElementPosition=function(){var L=C(F.options.position.refele);var O=F.options.position.reftop||0;var K=F.options.position.refleft||0;var R=(typeof F.options.position.adjust=="undefined")?true:F.options.position.adjust;var Q=L.offset().top+L.height();var M=L.offset().left;var P=document.documentElement.clientWidth||document.body.clientWidth;var T=document.documentElement.clientHeight||document.body.clientHeight;var S=document.documentElement.scrollTop||document.body.scrollTop;var J=document.documentElement.scrollLeft||document.body.scrollLeft;var I=S+T;var N=J+P;if(R&&M+F.dh.width()>N){M=N-F.dh.width()-1}if(R&&Q+F.dh.height()>I){Q=I-F.dh.height()-1}M=Math.max(M+K,0);Q=Math.max(Q+O,0);F.dh.css({top:Q,left:M})};this.initOptions();this.initMask();this.initBox();this.initContent();this.initEvent()};var D=function(){var F=this;this._onbox=false;this._opening=false;this.zIndex=999;this.length=function(){return E.length};this.open=function(J,G){F._opening=true;if(typeof(G)=="undefined"){G={}}if(G.boxid){for(var H=0;H<E.length;H++){if(E[H].dh.attr("id")==G.boxid){E[H].close();break}}}G.zIndex=F.zIndex;F.zIndex+=10;var I=new B(J,G);I.dh.click(function(){F._onbox=true});E.push(I);return I};this.getTopBox=function(){if(E.length>0){return E[E.length-1]}else{return false}};C(window).scroll(function(){if(E.length>0){for(i=0;i<E.length;i++){var G=E[i];if(G.options.position!="center"){G.setElementPosition()}if(G.mh){G.mh.css({width:G.bwidth(),height:G.bheight()})}}}}).resize(function(){if(E.length>0){var G=F.getTopBox();if(G.options.position=="center"){G.setCenterPosition()}if(G.mh){G.mh.css({width:G.bwidth(),height:G.bheight()})}}});C(document).click(function(H){if(H.button==2){return true}if(E.length>0){var G=F.getTopBox();if(!F._opening&&!F._onbox&&G.options.clickClose){G.close()}}F._opening=false;F._onbox=false}).keydown(function(G){var H;if(G.keyCode==9){if("activeElement" in document){H=document.activeElement}else{H=e?e.explicitOriginalTarget:null}if(E.length>0){if(H.calssName=="dialog-ok"){F.dh.find(".dialog-cancel").focus()}else{if(H.calssName=="dialog-cancel"){F.dh.find(".dialog-ok").focus()}else{C(window).focus()}}return false}}})};C.extend({weeboxs:new D()})})(jQuery);